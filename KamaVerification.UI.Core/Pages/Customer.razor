@page "/customer"
@using KamaVerification.UI.Core.Models;
@using KamaVerification.UI.Core.Services;
@inject ICustomerRepository _repo;

<PageTitle>Customer</PageTitle>

<h5><b>Create Customer</b></h5>

<Form Model="@customerDto" Layout="FormLayout.Horizontal">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <Text Label="Name" @bind-Value="customerDto.Name" HelpText="@($"Required. The name will be {customerDto.Name}")" />  
    <Select Label="Generate API Key" @bind-Value="customerDto.GenerateApiKeyStr" Items="generateApiKeyOptions" HelpText="@("Required")" />

    <h5>Email (Optional)</h5>
    <Text Label="Subject" @bind-Value="customerDto.EmailConfig.Subject" HelpText="Optional"></Text>
    <Text Label="From Email" @bind-Value="customerDto.EmailConfig.FromEmail" HelpText="Optional"></Text>
    <Text Label="From Name" @bind-Value="customerDto.EmailConfig.FromName" HelpText="Optional"></Text>
    <Text Label="Expiration (in minutes)" @bind-Value="customerDto.EmailConfig.ExpirationInMinutesStr" HelpText="Optional. In minutes"></Text>

    <Button id="create-btn" State="createBtnState" Outline="true" @onclick="HandleCreateCustomerAsync" Disabled="createBtnDisabled">Create</Button>
</Form>

@code {
    private CustomerDto customerDto = new();

    private string[] generateApiKeyOptions = new string[] { "Yes", "No" };

    private bool createBtnDisabled => !IsCreateButtonEnabled();
    private LoadingState createBtnState = LoadingState.Default;

    public async Task HandleCreateCustomerAsync()
    {
        createBtnState = LoadingState.Loading;

        await _repo.CreateAsync(customerDto);
        await Task.Delay(1000);

        createBtnState = LoadingState.Default;
    }

    public bool IsCreateButtonEnabled()
    {
        return !string.IsNullOrWhiteSpace(customerDto.Name);
    }
}
